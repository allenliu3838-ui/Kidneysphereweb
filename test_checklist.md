# 上线测试检查清单（Phase 1 · Email 登录）

> 目的：你每次部署后按这份清单走一遍，就能快速确认“邮箱注册/登录闭环是否稳定”。

---

## A. 配置与环境

- [ ] 已在 `assets/config.js` 填入 `SUPABASE_URL` 与 `SUPABASE_ANON_KEY`
- [ ] 站点已部署到 Netlify（HTTPS）
- [ ] Supabase 已确认 Email Provider 可用（默认开启）
- [ ] （测试建议）Confirm Email 已关闭，避免确认邮件影响测试节奏
- [ ] 已运行最新版 `SUPABASE_SETUP.sql`（包含 Moments / Frontier / 点赞 / 积分等级 / Storage bucket）
- [ ] Storage 已存在 public bucket：`moments`（用于动态图片/短视频上传）

---

## B. 自检页（推荐先看）

打开：`/health.html`

- [ ] 显示“Supabase 已配置：是”
- [ ] 未登录时：Current user 显示为空 / session 为 null

---

## C. 邮箱注册 & 登录

1) 打开 `register.html`

- [ ] 能注册（邮箱 + 密码）
- [ ] 若 Confirm Email 关闭：注册后能直接登录并跳转
- [ ] 若 Confirm Email 开启：页面提示“去邮箱确认”，确认后回到 `/auth-callback.html` 能完成登录

2) 打开 `login.html`

- [ ] 用邮箱 + 密码能登录成功
- [ ] 登录后右上角显示登录态（昵称/邮箱）
- [ ] 登录态里显示：头像（首字母） + 身份（member/医生/官方等） + Lv 等级徽标
- [ ] 回到 `/health.html`，能看到 user id 与 email

3) 退出

- [ ] 点击退出后 session 清空
- [ ] `/health.html` 显示未登录

---

## D. 受保护页面跳转

- [ ] 未登录访问 `post-case.html` 会跳转到 `login.html?next=...`
- [ ] 登录后会自动回到目标页面（next 回跳生效）

---

## E. 病例发布（如已建 cases 表）

- [ ] 登录后可以提交病例
- [ ] 发布成功后能在对应板块列表看到
- [ ] 删除病例：进入病例详情页，作者点击“删除”，跳回社区且列表不再显示该病例（网络不再 403）
- [ ] 删除评论：作者或管理员删除一条评论，评论列表中该评论消失（网络不再 403）

---

## G. Moments（社区动态）

- [ ] 能打开 `moments.html` 并看到动态流
- [ ] 纯文本发布：能成功发布一条动态
- [ ] 拖拽上传：拖拽 1-3 张图片到发布框，预览正常，发布成功后能显示图片
- [ ] 短视频发布：选择 1 个 mp4/mov，预览正常，发布成功后能播放
- [ ] 复制粘贴上传：从剪贴板粘贴图片，能进入预览并发布成功
- [ ] 点赞：对一条动态点赞/取消点赞，数量变化正常
- [ ] 删除动态：作者点击“删除”，动态从列表消失（网络不再 403）
- [ ] 编辑动态：作者点击“编辑”，修改文字或替换图片/视频后点击“保存修改”，列表刷新可见（可选：勾选“更新后置顶”测试是否置顶）

---

## H. 会议与活动管理（管理员）

- [ ] 管理员账号登录后，`events.html` 底部出现“管理员：管理会议与活动”面板
- [ ] 能修改 next_time（会议时间）并保存，前台列表立即更新
- [ ] 能把 status 改为 canceled / rescheduled，前台状态标签更新
- [ ] 能编辑 join_url / passcode（确认后普通会员可见）

---

## I. 前沿进展管理（管理员）

- [ ] 管理员账号登录后，`frontier.html` 底部出现“管理员：模块化内容管理”面板
- [ ] 能新增模块（cards / richtext / sponsors）并在页面渲染
- [ ] cards 模块：能新增卡片并展示链接/图片
- [ ] richtext 模块：能编辑正文并保存
- [ ] sponsors：能新增赞助商卡片并展示 logo / 官网链接

---

## J. 积分与等级（12 级）

- [ ] 发病例 / 发评论 / 发 Moments 后，右上角 Lv 等级或 points（title）有变化
- [ ] 点赞被收到后（病例/动态），points 增加（质量信号）

---

## F. 失败时记录信息（方便快速定位）

如果出问题，建议你记录：
- 你访问的 Netlify 地址
- `/health.html` 的截图
- 控制台报错（浏览器开发者工具 Console）
- Supabase Auth → Logs 中对应时间段的记录（如果有）


---

## F. 社区动态 Moments（发布 / 编辑 / 点赞 / 留言）

- [ ] 登录后可以发布纯文本动态
- [ ] 登录后可以发布：文本 + 图片（拖拽 / 选择文件 / Ctrl+V 粘贴截图）
- [ ] 登录后可以发布：文本 + 短视频（≤50MB）
- [ ] 发布后：电脑端/手机端都能看到自己的动态
- [ ] 编辑动态：作者可编辑内容/图片/视频，保存后刷新仍正确
- [ ] 删除动态：作者/管理员删除后列表不再显示（网络不再 403）
- [ ] 点赞/取消点赞：计数正确、刷新后状态正确
- [ ] 留言：任意登录用户可在动态下留言
- [ ] 回复：作者可回复任意留言（显示“作者”标识）
- [ ] 留言删除：留言作者可删；动态作者/管理员也可删除该动态下留言

---

## G. 管理后台（Admin Console）

- [ ] 管理员/超级管理员登录后可以打开 `admin.html`
- [ ] 非管理员账号打开 `admin.html` 会看到“无权限提示”，且无法写入数据库
- [ ] 会议与活动：在 `admin.html#events` 新增/编辑会议后，`events.html` 页面同步更新
- [ ] 临床研究中心：在 `admin.html#research` 更新“中心信息”后，`research.html` 页面同步更新
- [ ] 研究项目库：新增项目后，公开项目库显示；隐藏后不显示

