<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>写文章 · KidneySphere AI</title>
  <meta name="description" content="KidneySphere × KidneySphere AI">
  <link rel="icon" href="assets/logo.png" />
  <link rel="stylesheet" href="styles.css?v=20260212_002"/>
</head>
<body>

  <header class="nav">
    <div class="container nav-inner">
      <a class="brand" href="index.html" aria-label="KidneySphere Home">
        <img src="assets/logo.png" alt="KidneySphere AI Logo" />
        <div class="title">
          <b>肾域AI · KidneySphereAI</b>
          <span>GlomCon中国 × KidneySphere AI</span>
        </div>
      </a>

      <nav class="menu" aria-label="Primary">
        <a data-nav href="index.html"><span class="zh">首页</span><span class="en">Home</span></a>
        <a data-nav href="community.html"><span class="zh">社区讨论</span><span class="en">Community</span></a>
        <a data-nav href="learning.html"><span class="zh">学习中心</span><span class="en">Learning</span></a>
        <a data-nav href="frontier.html"><span class="zh">前沿进展</span><span class="en">Frontier</span></a>
        <a data-nav href="moments.html"><span class="zh">社区动态</span><span class="en">Moments</span></a>
        <a data-nav href="events.html"><span class="zh">会议与活动</span><span class="en">Events</span></a>
        <a data-nav href="research.html"><span class="zh">临床研究中心</span><span class="en">Research</span></a>
        <a data-nav href="about.html"><span class="zh">关于</span><span class="en">About</span></a>
      </nav>

      <div class="auth" data-auth>
        <a class="btn" href="login.html">登录</a>
        <a class="btn primary" href="register.html">注册</a>
      </div>
    </div>
  </header>

<main class="container">
  <div class="hero">
    <div>
      <div class="badge">Editor</div>
      <h1>写文章 / 编辑文章</h1>
      <p class="muted">仅管理员可使用。支持粘贴长文，自动在首页推送最新文章。</p>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
        <a class="btn" href="articles.html">← 返回文章列表</a>
      </div>
    </div>
  </div>

  <div class="card soft" style="margin-top:14px" id="editorGate">
    <div class="muted small">校验权限中…</div>
  </div>

  <div class="card soft" style="margin-top:14px" id="editorRoot" hidden>
    <div class="form-row" style="gap:10px;flex-wrap:wrap">
      <div style="flex:2;min-width:240px">
        <label class="small muted">标题</label>
        <input class="input" id="aTitle" placeholder="请输入文章标题"/>
      </div>
      <div style="flex:1;min-width:240px">
        <label class="small muted">状态</label>
        <select class="input" id="aStatus">
          <option value="draft">草稿</option>
          <option value="published">已发布</option>
          <option value="archived">归档</option>
        </select>
      </div>
      <div style="display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap">
        <label class="small muted" style="display:flex;gap:8px;align-items:center">
          <input type="checkbox" id="aPinned"/>
          置顶
        </label>
      </div>
    </div>

    <div class="form-row" style="gap:10px;flex-wrap:wrap;margin-top:10px">
      <div style="flex:2;min-width:240px">
        <label class="small muted">摘要（用于列表/首页展示）</label>
        <textarea class="input prose-input" id="aSummary" rows="2" placeholder="可选：简短摘要"></textarea>
      </div>
      <div style="flex:1;min-width:240px">
        <label class="small muted">封面图 URL（可选）</label>
        <input class="input" id="aCover" placeholder="https://..."/>
      </div>
    </div>

    <div class="form-row" style="gap:10px;flex-wrap:wrap;margin-top:10px">
      <div style="flex:1;min-width:320px">
        <label class="small muted">上传图片 / 短视频（MP4 ≤ 50MB）</label>
        <input class="input" id="aMediaFile" type="file" accept="image/*,video/mp4,application/pdf,.pdf,.doc,.docx" />
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;align-items:center">
          <button class="btn tiny" id="aUploadInsert" type="button">上传并插入正文</button>
          <button class="btn tiny" id="aUploadCover" type="button">上传并设为封面</button>
          <span class="small muted" id="aUploadMsg"></span>
        </div>
        <div class="small muted" style="margin-top:8px">
          图片 / 视频 / PDF / Word 上传后会以网页元素插入正文（适配电脑与手机，可再次编辑）。
        </div>
      </div>
    </div>

    <div class="form-row" style="gap:10px;flex-wrap:wrap;margin-top:10px">
      <div style="flex:1;min-width:240px">
        <label class="small muted">标签（逗号分隔，可选）</label>
        <input class="input" id="aTags" placeholder="例如：AAV, 指南, 综述"/>
      </div>
      <div style="flex:1;min-width:240px">
        <label class="small muted">作者显示名（可选，不填则自动取你的姓名）</label>
        <input class="input" id="aAuthorName" placeholder="例如：刘松 / KidneySphere 编辑部"/>
      </div>
    </div>

    <div class="hr"></div>

    <div class="form-row" style="gap:10px;flex-wrap:wrap;margin-top:10px">
      <div style="flex:1;min-width:260px">
        <label class="small muted">文章模板（可选）</label>
        <select class="input" id="aTemplate">
          <option value="">不使用模板</option>
          <option value="im_note">内科笔记模板（学习笔记）</option>
          <option value="case_review">病例复盘模板（Case Review）</option>
          <option value="guideline">指南/共识速览模板</option>
          <option value="drug">用药总结模板</option>
        </select>
      </div>
      <div style="display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap">
        <button class="btn tiny" id="aApplyTemplate" type="button">一键套模板</button>
        <button class="btn tiny" id="aAutoFormat" type="button">一键排版</button>
        <button class="btn tiny" id="aSmartOrganize" type="button" disabled title="智能整理（AI）即将上线">智能整理（即将上线）</button>
      </div>
    </div>
    <div class="small muted" style="margin-top:8px">
      提示：模板用于规范结构；“一键排版”只调整格式（标题/段落/列表等），不会改动医学内容。
    </div>

    <div class="form-row" style="gap:10px;flex-wrap:wrap;align-items:flex-start">
      <div style="flex:1;min-width:320px">
        <label class="small muted">正文（所见即所得：支持加粗 / 颜色 / 列表 / 表格；从 Word 复制可自动排版）</label>
        <textarea class="input prose-input" id="aContent" rows="16" placeholder="# 标题\n\n正文…"></textarea>

        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;align-items:center">
          <button class="btn primary" id="aSaveBtn" type="button">保存</button>
          <button class="btn" id="aPreviewBtn" type="button">预览</button>
          <button class="btn danger" id="aDeleteBtn" type="button">删除</button>
          <span class="small muted" id="aStatusMsg"></span>
        </div>

        <div class="small muted" style="margin-top:10px">
          提示：发布后会出现在「文章」列表，并在首页展示最新文章（可置顶）。
        </div>
      </div>

      <div style="flex:1;min-width:320px">
        <div class="small muted">预览</div>
        <div class="card soft article-preview" id="aPreview" style="margin-top:10px;max-height:520px;overflow:auto">
          <div class="muted small">点击“预览”查看渲染效果。</div>
        </div>
      </div>
    </div>
  </div>
</main>

<footer class="footer">
  <div class="muted small">© 2025-2026 KidneySphere</div>
</footer>

<script type="module" src="app.js?v=20260128_030"></script>
<script type="module" src="article-editor.js?v=20260212_002"></script>
</body>
</html>
