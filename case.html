<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>病例详情 · KidneySphere</title>
  <meta name="description" content="KidneySphere · Case Detail">
  <link rel="icon" href="assets/logo.png" />
  <link rel="stylesheet" href="styles.css?v=20260213_001" />
</head>
<body class="page-case">
  <header class="nav"></header>

  <main>
    <section class="hero">
      <div class="container">
        <div class="card">
          <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;align-items:flex-start">
            <div style="min-width:0">
      <span class="badge" id="caseBadge">Case · 病例</span>
              <h1 id="caseTitle" style="margin-top:10px">加载中…</h1>
              <div class="small muted" id="caseMeta" style="margin-top:6px"></div>
              <div id="caseTags" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px"></div>
              <div class="small" style="margin-top:12px;display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap">
                <button class="btn" id="likeBtn" type="button" title="给这个帖子点个赞（用于质量积分）">👍 赞 <span id="likeCount">0</span></button>
                <button class="btn" id="favBtn" type="button" title="收藏到我的收藏列表">⭐ 收藏</button>
              </div>
            </div>
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <a class="btn" href="javascript:history.back()">返回</a>
              <button class="btn danger" id="deleteBtn" hidden>删除</button>
            </div>
          </div>

          <div class="hr"></div>
          <div id="caseBody">
            <p class="muted">正在读取病例内容…</p>
          </div>

          <div id="caseAttachBlock" style="margin-top:12px"></div>

          <!-- AI Summary / Structured (Stage 1: Free AI + manual paste-back) -->
          <div id="aiSummaryBlock" style="margin-top:16px" hidden></div>
          <div id="aiStructuredBlock" style="margin-top:12px" hidden></div>
          <div id="aiToolsBlock" style="margin-top:12px" hidden></div>

          <div class="hr"></div>

          <div class="section-title">
            <div>
              <h3>评论与讨论</h3>
              <p>桌面端默认展开便于阅读；手机端可折叠查看全文与附件。请注意去标识化与学术讨论规范。</p>
            </div>
            <span class="badge">Reply</span>
          </div>

          <div id="commentList" class="case-thread" style="margin-top:12px"></div>

          <div class="hr"></div>

          <form id="commentForm" class="form">
            <label>发表回复</label>
            <textarea class="input" id="commentBody" rows="4" placeholder="请输入评论内容（避免包含患者姓名、住院号、电话等可识别信息）" required></textarea>

            <div class="attach-tools" style="margin-top:10px">
              <input id="caseAttachInput" type="file" multiple hidden accept="image/*,application/pdf,.pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" />
              <button class="btn tiny" type="button" id="casePickAttachBtn">📎 添加附件</button>
              <button class="btn tiny" type="button" id="caseClearAttachBtn">清空</button>
              <span class="attach-hint">支持图片 / PDF / Word（单个≤20MB，最多 9 个；可直接拖拽/粘贴到输入框）</span>
            </div>
            <div id="caseAttachPreview" class="attach-list"></div>

            <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;align-items:center">
              <button class="btn tiny" type="button" id="commentMentionAuthor" title="@病例作者">@作者</button>
              <button class="btn tiny" type="button" id="commentMentionDoctor" title="@其他医生">@医生</button>
              <button class="btn primary" id="commentSubmit" type="submit">发布回复</button>
              <span class="small muted" id="commentHint"></span>
            </div>
          </form>

          <!-- Comment detail modal (thread-style reading) -->
          <div id="commentModal" class="modal" hidden>
            <div class="modal-panel">
              <div class="modal-head">
                <div style="min-width:0">
                  <b id="modalAuthor">成员</b>
                  <div class="small muted" id="modalWhen" style="margin-top:4px"></div>
                </div>
                <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
                  <button class="btn tiny" id="modalLikeBtn" type="button">👍 点赞 · 0</button>
                  <button class="btn tiny danger" id="modalDeleteBtn" hidden>删除</button>
                  <button class="modal-close" id="modalCloseBtn" type="button">关闭</button>
                </div>
              </div>
              <div class="hr"></div>
              <div id="modalBody" class="ks-prose"></div>
              <div id="modalAttaches" style="margin-top:10px"></div>
            </div>
          </div>

        </div>
      </div>
    </section>
  </main>
<footer class="footer" data-blurb="病例内容仅供学术交流；发布前请完成去标识化处理。"></footer>
  <script type="module" src="case.js?v=20260219_001"></script>
  <script type="module" src="app.js?v=20260128_030"></script>
</body>
</html>
